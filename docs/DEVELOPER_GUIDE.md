# Lã‚¹ãƒ†ãƒƒãƒ—é›†è¨ˆãƒ„ãƒ¼ãƒ« - é–‹ç™ºè€…ã‚¬ã‚¤ãƒ‰

## ğŸ“š ç›®æ¬¡

1. [é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
2. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦)
3. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ](#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ )
4. [ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„](#ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„)
5. [çŠ¶æ…‹ç®¡ç†ï¼ˆZustandï¼‰](#çŠ¶æ…‹ç®¡ç†zustand)
6. [ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼](#ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼)
7. [ä¸»è¦ãªãƒ­ã‚¸ãƒƒã‚¯](#ä¸»è¦ãªãƒ­ã‚¸ãƒƒã‚¯)
8. [ãƒ†ã‚¹ãƒˆ](#ãƒ†ã‚¹ãƒˆ)
9. [æ–°æ©Ÿèƒ½ã®è¿½åŠ æ–¹æ³•](#æ–°æ©Ÿèƒ½ã®è¿½åŠ æ–¹æ³•)
10. [ãƒ‡ãƒãƒƒã‚°](#ãƒ‡ãƒãƒƒã‚°)
11. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–](#ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–)
12. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶

- **Node.js**: 18ä»¥ä¸Š
- **npm**: 9ä»¥ä¸Š
- **Git**: 2.xä»¥ä¸Š
- **ã‚¨ãƒ‡ã‚£ã‚¿**: VS Codeæ¨å¥¨ï¼ˆTypeScriptå¯¾å¿œï¼‰

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³
git clone <repository-url>
cd Lstepé›†è¨ˆãƒ„ãƒ¼ãƒ«

# ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ï¼ˆãƒãƒ¼ãƒˆ3247ï¼‰
npm run dev

# åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
npm test

# ãƒ“ãƒ«ãƒ‰
npm run build

# ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆæœ¬ç•ªç’°å¢ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
npm run preview
```

### VS Codeæ¨å¥¨æ‹¡å¼µæ©Ÿèƒ½

```json
{
  "recommendations": [
    "dbaeumer.vscode-eslint",
    "esbenp.prettier-vscode",
    "bradlc.vscode-tailwindcss",
    "ms-vscode.vscode-typescript-next"
  ]
}
```

### ç’°å¢ƒå¤‰æ•°

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ã—ã¾ã›ã‚“ï¼ˆå®Œå…¨ã«ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§å‹•ä½œï¼‰ã€‚

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

```yaml
ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰:
  - React 18: UIãƒ©ã‚¤ãƒ–ãƒ©ãƒª
  - TypeScript 5: å‹å®‰å…¨æ€§
  - Vite 5: ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ï¼ˆé«˜é€ŸHMRï¼‰
  - MUI v7: UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

çŠ¶æ…‹ç®¡ç†:
  - Zustand 5.0.9: ã‚·ãƒ³ãƒ—ãƒ«ãªçŠ¶æ…‹ç®¡ç†

ãƒ‡ãƒ¼ã‚¿å‡¦ç†:
  - PapaParse 5.5.3: CSVè§£æ
  - TanStack Table 8.21.3: ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º
  - Recharts 3.5.1: ã‚°ãƒ©ãƒ•è¡¨ç¤º
  - SheetJS 0.18.5: ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆç”Ÿæˆ

ãƒ‡ãƒ¼ã‚¿ä¿å­˜:
  - IndexedDB: ãƒ–ãƒ©ã‚¦ã‚¶å†…æ°¸ç¶šåŒ–

ãƒ†ã‚¹ãƒˆ:
  - Vitest 4.0.14: ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
  - React Testing Library: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
  - jsdom: DOMç’°å¢ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

ãƒ‡ãƒ—ãƒ­ã‚¤:
  - Vercel: ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ï¼ˆç„¡æ–™ãƒ—ãƒ©ãƒ³ï¼‰
```

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç‰¹å¾´

#### 1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã¿ï¼ˆNo Backendï¼‰

- ã™ã¹ã¦ã®å‡¦ç†ãŒãƒ–ãƒ©ã‚¦ã‚¶å†…ã§å®Œçµ
- ã‚µãƒ¼ãƒãƒ¼ä¸è¦
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§å‹•ä½œå¯èƒ½

#### 2. ç©¶æ¥µã®MVPï¼ˆ1ãƒšãƒ¼ã‚¸æ§‹æˆï¼‰

- ã‚·ãƒ³ã‚°ãƒ«ãƒšãƒ¼ã‚¸ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆSPAï¼‰
- ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ä¸è¦
- ã‚·ãƒ³ãƒ—ãƒ«ã§ä¿å®ˆã—ã‚„ã™ã„

#### 3. ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼é‡è¦–

- å¤–éƒ¨ã‚µãƒ¼ãƒãƒ¼ã¸ã®é€ä¿¡ãªã—
- IndexedDBã§ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜
- GDPR/å€‹äººæƒ…å ±ä¿è­·æ³•æº–æ‹ 

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
Lstepé›†è¨ˆãƒ„ãƒ¼ãƒ«/
â”œâ”€â”€ docs/                          # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ requirements.md            # è¦ä»¶å®šç¾©æ›¸
â”‚   â”œâ”€â”€ SCOPE_PROGRESS.md          # é€²æ—ç®¡ç†
â”‚   â”œâ”€â”€ DEPLOYMENT.md              # ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰
â”‚   â”œâ”€â”€ USER_MANUAL.md             # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ‹ãƒ¥ã‚¢ãƒ«
â”‚   â””â”€â”€ DEVELOPER_GUIDE.md         # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/                # Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ CsvUploader.tsx        # CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
â”‚   â”‚   â”œâ”€â”€ SummaryCard.tsx        # ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰
â”‚   â”‚   â”œâ”€â”€ StaffTable.tsx         # ç›¸è«‡å“¡åˆ¥å®Ÿç¸¾ãƒ†ãƒ¼ãƒ–ãƒ«
â”‚   â”‚   â”œâ”€â”€ DailyChart.tsx         # æ—¥åˆ¥ã‚°ãƒ©ãƒ•
â”‚   â”‚   â”œâ”€â”€ MonthlyChart.tsx       # æœˆåˆ¥ã‚°ãƒ©ãƒ•
â”‚   â”‚   â”œâ”€â”€ ReviewList.tsx         # è¦ç¢ºèªãƒªã‚¹ãƒˆ
â”‚   â”‚   â”œâ”€â”€ CancellationList.tsx   # ã‚­ãƒ£ãƒ³ã‚»ãƒ«ä¸€è¦§
â”‚   â”‚   â””â”€â”€ HistoryView.tsx        # å±¥æ­´è¡¨ç¤º
â”‚   â”œâ”€â”€ utils/                     # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”‚   â”‚   â”œâ”€â”€ csvParser.ts           # CSVè§£æ
â”‚   â”‚   â”œâ”€â”€ dataAggregator.ts      # ãƒ‡ãƒ¼ã‚¿é›†è¨ˆ
â”‚   â”‚   â”œâ”€â”€ reviewDetector.ts      # è¦ç¢ºèªãƒªã‚¹ãƒˆæ¤œå‡º
â”‚   â”‚   â”œâ”€â”€ spreadsheetGenerator.ts # ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ masterDataManager.ts   # å±¥æ­´ãƒã‚¹ã‚¿ç®¡ç†ï¼ˆIndexedDBï¼‰
â”‚   â”‚   â””â”€â”€ aggregationHistoryManager.ts # é›†è¨ˆå±¥æ­´ç®¡ç†ï¼ˆIndexedDBï¼‰
â”‚   â”œâ”€â”€ store/                     # ZustandçŠ¶æ…‹ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ csvStore.ts            # CSVãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢
â”‚   â”‚   â”œâ”€â”€ masterStore.ts         # å±¥æ­´ãƒã‚¹ã‚¿ã‚¹ãƒˆã‚¢
â”‚   â”‚   â”œâ”€â”€ aggregationStore.ts    # é›†è¨ˆçµæœã‚¹ãƒˆã‚¢
â”‚   â”‚   â””â”€â”€ reviewStore.ts         # è¦ç¢ºèªãƒªã‚¹ãƒˆã‚¹ãƒˆã‚¢
â”‚   â”œâ”€â”€ types/                     # TypeScriptå‹å®šç¾©
â”‚   â”‚   â””â”€â”€ index.ts               # å…¨å‹å®šç¾©
â”‚   â”œâ”€â”€ test/                      # ãƒ†ã‚¹ãƒˆè¨­å®š
â”‚   â”‚   â””â”€â”€ setup.ts               # Vitestã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
â”‚   â”œâ”€â”€ App.tsx                    # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ App.css                    # ã‚¢ãƒ—ãƒªã‚¹ã‚¿ã‚¤ãƒ«
â”‚   â”œâ”€â”€ main.tsx                   # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â””â”€â”€ index.css                  # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«
â”œâ”€â”€ .eslintrc.cjs                  # ESLintè¨­å®š
â”œâ”€â”€ .prettierrc                    # Prettierè¨­å®š
â”œâ”€â”€ .gitignore                     # Gité™¤å¤–è¨­å®š
â”œâ”€â”€ CLAUDE.md                      # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
â”œâ”€â”€ package.json                   # npmè¨­å®š
â”œâ”€â”€ tsconfig.json                  # TypeScriptè¨­å®š
â”œâ”€â”€ vite.config.ts                 # Viteè¨­å®š
â”œâ”€â”€ vitest.config.ts               # Vitestè¨­å®š
â””â”€â”€ vercel.json                    # Vercelè¨­å®š
```

---

## ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

### å‘½åè¦å‰‡

#### ãƒ•ã‚¡ã‚¤ãƒ«å

```typescript
// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: PascalCase
CsvUploader.tsx
SummaryCard.tsx

// ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£: camelCase
csvParser.ts
dataAggregator.ts

// å‹å®šç¾©
types/index.ts
```

#### å¤‰æ•°ãƒ»é–¢æ•°

```typescript
// å¤‰æ•°: camelCase
const csvData = ...;
const aggregationResult = ...;

// é–¢æ•°: camelCase
function parseCSV(...) { ... }
function calculateConversionRate(...) { ... }

// å®šæ•°: UPPER_SNAKE_CASE
const MAX_FILE_SIZE = 10 * 1024 * 1024;
const IMPLEMENTED_STATUSES = ['äºˆç´„æ¸ˆã¿'];

// å‹/ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹: PascalCase
interface CsvRecord { ... }
type AggregationResult = { ... };
```

### TypeScript strictãƒ¢ãƒ¼ãƒ‰

ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§`strict`ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã—ã¦ã„ã¾ã™ã€‚

```typescript
// tsconfig.json
{
  "compilerOptions": {
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true
  }
}
```

### ã‚³ãƒ¼ãƒ‰å“è³ªåŸºæº–

```yaml
é–¢æ•°è¡Œæ•°: 100è¡Œä»¥ä¸‹ï¼ˆæ¨å¥¨: 50è¡Œä»¥ä¸‹ï¼‰
ãƒ•ã‚¡ã‚¤ãƒ«è¡Œæ•°: 700è¡Œä»¥ä¸‹
è¤‡é›‘åº¦: 10ä»¥ä¸‹
è¡Œé•·: 120æ–‡å­—ä»¥ä¸‹

å¿…é ˆ:
  - æœªä½¿ç”¨ã®å¤‰æ•°/importç¦æ­¢
  - console.logæœ¬ç•ªç’°å¢ƒç¦æ­¢ï¼ˆconsole.warn, console.errorã¯è¨±å¯ï¼‰
  - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¿…é ˆ
  - å‹å®šç¾©å¿…é ˆï¼ˆanyã®ä½¿ç”¨ç¦æ­¢ï¼‰
```

### ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆPrettierï¼‰

```json
{
  "semi": true,
  "singleQuote": true,
  "tabWidth": 2,
  "printWidth": 120,
  "trailingComma": "es5"
}
```

---

## çŠ¶æ…‹ç®¡ç†ï¼ˆZustandï¼‰

### 4ã¤ã®ã‚¹ãƒˆã‚¢æ§‹æˆ

```typescript
// 1. csvStore: CSVãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†
interface CsvStore {
  csvData: CsvRecord[];
  setCsvData: (data: CsvRecord[]) => void;
  clearCsvData: () => void;
}

// 2. masterStore: å±¥æ­´ãƒã‚¹ã‚¿ç®¡ç†
interface MasterStore {
  masterData: Map<string, UserHistoryMaster>;
  getAllMasterData: () => Promise<void>;
  updateMasterData: (newRecords: UserHistoryMaster[]) => Promise<void>;
  clearMasterData: () => Promise<void>;
}

// 3. aggregationStore: é›†è¨ˆçµæœç®¡ç†
interface AggregationStore {
  summary: AggregationSummary | null;
  staffResults: StaffResult[];
  dailyResults: DailyResult[];
  monthlyResults: MonthlyResult[];
  spreadsheetData: SpreadsheetOutputData | null;
  processData: (csvData: CsvRecord[], masterData: Map<string, UserHistoryMaster>) => Promise<void>;
  clearAggregation: () => void;
}

// 4. reviewStore: è¦ç¢ºèªãƒªã‚¹ãƒˆç®¡ç†
interface ReviewStore {
  pattern1: ReviewRecord[];
  pattern2: ReviewRecord[];
  pattern3: ReviewRecord[];
  cancellations: CancellationRecord[];
  detectReviews: (csvData: CsvRecord[], masterData: Map<string, UserHistoryMaster>) => void;
  clearReviews: () => void;
}
```

### ã‚¹ãƒˆã‚¢ã®ä½¿ç”¨æ–¹æ³•

```typescript
// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ã®ä½¿ç”¨
import { useCsvStore } from './store/csvStore';
import { useAggregationStore } from './store/aggregationStore';

function MyComponent() {
  // ã‚¹ãƒˆã‚¢ã‹ã‚‰çŠ¶æ…‹ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å–å¾—
  const { csvData, setCsvData } = useCsvStore();
  const { summary, processData } = useAggregationStore();

  // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œ
  const handleUpload = async (file: File) => {
    const data = await parseCSV(file);
    setCsvData(data);
    await processData(data, masterData);
  };

  return <div>...</div>;
}
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### 1. CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‹ã‚‰é›†è¨ˆã¾ã§

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼: CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
   â†“
2. CsvUploader: ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆvalidateCSVFileï¼‰
   â†“
3. csvParser: CSVè§£æï¼ˆparseCSVï¼‰
   â†“
4. csvStore: CSVãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ï¼ˆsetCsvDataï¼‰
   â†“
5. masterStore: å±¥æ­´ãƒã‚¹ã‚¿ã‚’èª­ã¿è¾¼ã¿ï¼ˆgetAllMasterDataï¼‰
   â†“
6. aggregationStore: ãƒ‡ãƒ¼ã‚¿é›†è¨ˆï¼ˆprocessDataï¼‰
   â”œâ”€ dataAggregator.aggregateAll: å…¨é›†è¨ˆå®Ÿè¡Œ
   â”‚  â”œâ”€ aggregateSummary: ã‚µãƒãƒªãƒ¼é›†è¨ˆ
   â”‚  â”œâ”€ aggregateByStaff: ç›¸è«‡å“¡åˆ¥é›†è¨ˆ
   â”‚  â”œâ”€ aggregateByDate: æ—¥åˆ¥é›†è¨ˆ
   â”‚  â”œâ”€ aggregateByMonth: æœˆåˆ¥é›†è¨ˆ
   â”‚  â””â”€ generateSpreadsheetData: ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
   â””â”€ aggregationHistoryManager.saveHistory: å±¥æ­´ä¿å­˜
   â†“
7. reviewStore: è¦ç¢ºèªãƒªã‚¹ãƒˆæ¤œå‡ºï¼ˆdetectReviewsï¼‰
   â”œâ”€ reviewDetector.detectPattern1: ãƒ‘ã‚¿ãƒ¼ãƒ³1æ¤œå‡º
   â”œâ”€ reviewDetector.detectPattern2: ãƒ‘ã‚¿ãƒ¼ãƒ³2æ¤œå‡º
   â”œâ”€ reviewDetector.detectPattern3: ãƒ‘ã‚¿ãƒ¼ãƒ³3æ¤œå‡º
   â””â”€ reviewDetector.generateCancellationList: ã‚­ãƒ£ãƒ³ã‚»ãƒ«ä¸€è¦§ç”Ÿæˆ
   â†“
8. masterStore: å±¥æ­´ãƒã‚¹ã‚¿ã‚’æ›´æ–°ï¼ˆupdateMasterDataï¼‰
   â”œâ”€ dataAggregator.updateMasterData: å®Ÿæ–½æ¸ˆã¿ãƒ¬ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ãƒã‚¹ã‚¿æ›´æ–°
   â””â”€ masterDataManager.saveMasterDataBatch: IndexedDBã«ä¿å­˜
   â†“
9. UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: é›†è¨ˆçµæœã‚’è¡¨ç¤º
```

### 2. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆå‡ºåŠ›

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã€Œã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆå‡ºåŠ›ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
   â†“
2. App.tsx: handleDownloadSpreadsheetå®Ÿè¡Œ
   â†“
3. spreadsheetGenerator: Excelç”Ÿæˆï¼ˆgenerateSpreadsheetï¼‰
   â”œâ”€ ãƒ‡ãƒ¼ã‚¿è¡Œä½œæˆï¼ˆAB~AMåˆ—ï¼‰
   â”œâ”€ TTLè¡Œè¿½åŠ 
   â”œâ”€ ã‚»ãƒ«ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š
   â””â”€ ãƒ•ã‚¡ã‚¤ãƒ«åç”Ÿæˆ
   â†“
4. ãƒ–ãƒ©ã‚¦ã‚¶: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
```

### 3. å±¥æ­´ç®¡ç†

```
1. aggregationStore.processDataå®Ÿè¡Œæ™‚
   â†“
2. aggregationHistoryManager.saveHistory
   â†“
3. IndexedDB: aggregation-historyã‚¹ãƒˆã‚¢ã«ä¿å­˜
   â”œâ”€ ID: YYYYMMï¼ˆä¾‹: 202512ï¼‰
   â”œâ”€ month: YYYY-MM
   â”œâ”€ summary, staffResults, dailyResults, monthlyResults
   â”œâ”€ spreadsheetData
   â””â”€ createdAt, updatedAt
   â†“
4. HistoryView: å±¥æ­´è¡¨ç¤º
   â”œâ”€ aggregationHistoryManager.getAllHistories
   â””â”€ æ–°ã—ã„é †ã«ã‚½ãƒ¼ãƒˆè¡¨ç¤º
```

---

## ä¸»è¦ãªãƒ­ã‚¸ãƒƒã‚¯

### 1. CSVè§£æï¼ˆcsvParser.tsï¼‰

#### ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

```typescript
export function validateCSVFile(file: File): { valid: boolean; error?: string | null } {
  // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ãƒã‚§ãƒƒã‚¯
  if (!file.name.endsWith('.csv') && file.type !== 'text/csv') {
    return { valid: false, error: 'CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼ˆæ‹¡å¼µå­: .csvï¼‰' };
  }

  // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ï¼ˆ10MBåˆ¶é™ï¼‰
  const MAX_FILE_SIZE = 10 * 1024 * 1024;
  if (file.size > MAX_FILE_SIZE) {
    return { valid: false, error: `ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™ï¼ˆæœ€å¤§: 10MBï¼‰` };
  }

  // ç©ºãƒ•ã‚¡ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯
  if (file.size === 0) {
    return { valid: false, error: 'ãƒ•ã‚¡ã‚¤ãƒ«ãŒç©ºã§ã™' };
  }

  return { valid: true, error: null };
}
```

#### CSVè§£æ

```typescript
export async function parseCSV(file: File): Promise<CsvRecord[]> {
  return new Promise((resolve, reject) => {
    Papa.parse(file, {
      header: true,
      skipEmptyLines: true,
      encoding: 'UTF-8',
      complete: (results) => {
        // å¿…é ˆã‚«ãƒ©ãƒ ã®æ¤œè¨¼
        const requiredColumns = ['äºˆç´„ID', 'å‹ã ã¡ID', 'äºˆç´„æ—¥', 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', 'æ¥åº—/æ¥å ´', 'åå‰', 'ç”³è¾¼æ—¥æ™‚'];
        const headers = results.meta.fields || [];
        const missingColumns = requiredColumns.filter(col => !headers.includes(col));

        if (missingColumns.length > 0) {
          reject(new Error(`å¿…é ˆã‚«ãƒ©ãƒ ãŒä¸è¶³ã—ã¦ã„ã¾ã™: ${missingColumns.join(', ')}`));
          return;
        }

        resolve(results.data as CsvRecord[]);
      },
      error: (error) => reject(error),
    });
  });
}
```

### 2. ãƒ‡ãƒ¼ã‚¿é›†è¨ˆï¼ˆdataAggregator.tsï¼‰

#### å®Ÿæ–½åˆ¤å®š

```typescript
export function isImplemented(record: CsvRecord): boolean {
  return record.ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ === 'äºˆç´„æ¸ˆã¿' && record['æ¥åº—/æ¥å ´'] === 'æ¸ˆã¿';
}
```

**é‡è¦**: ã“ã®2ã¤ã®æ¡ä»¶ã‚’**ä¸¡æ–¹æº€ãŸã™**å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

#### åˆå›/2å›ç›®ä»¥é™åˆ¤å®š

```typescript
export function getVisitType(friendId: string, masterData: Map<string, UserHistoryMaster>): VisitType {
  const master = masterData.get(friendId);

  if (!master || master.implementationCount === 0) {
    return 'åˆå›';
  } else if (master.implementationCount === 1) {
    return '2å›ç›®';
  } else {
    return '3å›ç›®ä»¥é™';
  }
}
```

#### ã‚µãƒãƒªãƒ¼é›†è¨ˆ

```typescript
export function aggregateSummary(csvData: CsvRecord[], masterData: Map<string, UserHistoryMaster>): AggregationSummary {
  let firstTotal = 0, firstImplemented = 0, firstCancelled = 0;
  let repeatTotal = 0, repeatImplemented = 0, repeatCancelled = 0;

  csvData.forEach(record => {
    const visitType = getVisitType(record.å‹ã ã¡ID, masterData);
    const implemented = isImplemented(record);
    const cancelled = record.ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ === 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿';

    if (visitType === 'åˆå›') {
      firstTotal++;
      if (implemented) firstImplemented++;
      if (cancelled) firstCancelled++;
    } else {
      repeatTotal++;
      if (implemented) repeatImplemented++;
      if (cancelled) repeatCancelled++;
    }
  });

  return {
    first: {
      total: firstTotal,
      implemented: firstImplemented,
      cancelled: firstCancelled,
      implementationRate: firstTotal > 0 ? (firstImplemented / firstTotal) * 100 : 0,
    },
    repeat: {
      total: repeatTotal,
      implemented: repeatImplemented,
      cancelled: repeatCancelled,
      implementationRate: repeatTotal > 0 ? (repeatImplemented / repeatTotal) * 100 : 0,
    },
  };
}
```

### 3. è¦ç¢ºèªãƒªã‚¹ãƒˆæ¤œå‡ºï¼ˆreviewDetector.tsï¼‰

#### ãƒ‘ã‚¿ãƒ¼ãƒ³1: ãƒ‡ãƒ¼ã‚¿ä¸æ•´åˆ

```typescript
export function detectPattern1(csvData: CsvRecord[]): ReviewRecord[] {
  return csvData
    .filter(record => record.ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ === 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿' && record['æ¥åº—/æ¥å ´'] === 'æ¸ˆã¿')
    .map(record => ({
      ...record,
      pattern: 'pattern1' as const,
      reason: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒã€Œã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿ã€ãªã®ã«ã€Œæ¥åº—/æ¥å ´ã€ãŒã€Œæ¸ˆã¿ã€ã§ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚',
    }));
}
```

#### ãƒ‘ã‚¿ãƒ¼ãƒ³2: æœªæ¥åº—

```typescript
export function detectPattern2(csvData: CsvRecord[]): ReviewRecord[] {
  return csvData
    .filter(record => record.ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ === 'äºˆç´„æ¸ˆã¿' && record['æ¥åº—/æ¥å ´'] === 'ãªã—')
    .map(record => ({
      ...record,
      pattern: 'pattern2' as const,
      reason: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒã€Œäºˆç´„æ¸ˆã¿ã€ã§ã™ãŒã€Œæ¥åº—/æ¥å ´ã€ãŒã€Œãªã—ã€ã§ã™ã€‚æ¥åº—/æ¥å ´ã®è¨˜éŒ²ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚',
    }));
}
```

#### ãƒ‘ã‚¿ãƒ¼ãƒ³3: é€šå¸¸ã‚­ãƒ£ãƒ³ã‚»ãƒ«

```typescript
export function detectPattern3(csvData: CsvRecord[]): ReviewRecord[] {
  return csvData
    .filter(record => record.ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ === 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿' && record['æ¥åº—/æ¥å ´'] === 'ãªã—')
    .map(record => ({
      ...record,
      pattern: 'pattern3' as const,
      reason: 'é€šå¸¸ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã§ã™ã€‚å¿…è¦ã«å¿œã˜ã¦ç†ç”±ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚',
    }));
}
```

### 4. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆç”Ÿæˆï¼ˆspreadsheetGenerator.tsï¼‰

```typescript
export function generateSpreadsheet(data: SpreadsheetOutputData, month: string): void {
  const workbook = XLSX.utils.book_new();

  // AB~AMåˆ—ã¸ã®8é …ç›®ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›
  const sheetData: unknown[][] = [
    // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œï¼ˆ27åˆ—åˆ†ã®ã‚¹ãƒšãƒ¼ã‚¹ + 8é …ç›®ï¼‰
    ['', '', '', ...Array(27).fill(''),
     'åˆå›äºˆç´„åˆè¨ˆ', 'åˆå›äºˆç´„ç‡(%)', 'åˆå›å®Ÿæ–½åˆè¨ˆ', 'åˆå›å®Ÿæ–½ç‡(%)',
     '', '', '', '',
     '2å›ç›®ä»¥é™äºˆç´„åˆè¨ˆ', '2å›ç›®ä»¥é™äºˆç´„ç‡(%)', '2å›ç›®ä»¥é™å®Ÿæ–½åˆè¨ˆ', '2å›ç›®ä»¥é™å®Ÿæ–½ç‡(%)'],

    // ãƒ‡ãƒ¼ã‚¿è¡Œ
    ['', '', '', ...Array(27).fill(''),
     data.AB, data.AC, data.AD, data.AE,
     '', '', '', '',
     data.AJ, data.AK, data.AL, data.AM],
  ];

  // TTLè¡Œè¿½åŠ 
  sheetData.push(['TTL', '', '', ...Array(27).fill(''),
    data.AB, data.AC, data.AD, data.AE,
    '', '', '', '',
    data.AJ, data.AK, data.AL, data.AM]);

  const worksheet = XLSX.utils.aoa_to_sheet(sheetData);
  XLSX.utils.book_append_sheet(workbook, worksheet, 'Sheet1');

  // ãƒ•ã‚¡ã‚¤ãƒ«åç”Ÿæˆ
  const year = month.split('-')[0];
  const monthNum = month.split('-')[1];
  const dateStr = new Date().toISOString().slice(0, 10).replace(/-/g, '');
  const fileName = `Lã‚¹ãƒ†ãƒƒãƒ—é›†è¨ˆ_${year}å¹´${monthNum}æœˆ_${dateStr}.xlsx`;

  // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
  XLSX.writeFile(workbook, fileName);
}
```

### 5. IndexedDBç®¡ç†

#### å±¥æ­´ãƒã‚¹ã‚¿ç®¡ç†ï¼ˆmasterDataManager.tsï¼‰

```typescript
const DB_NAME = 'lstep-aggregation-db';
const MASTER_STORE_NAME = 'user-history-master';

async function openDatabase(): Promise<IDBDatabase> {
  return new Promise((resolve, reject) => {
    const request = indexedDB.open(DB_NAME, 2);

    request.onerror = () => reject(request.error);
    request.onsuccess = () => resolve(request.result);

    request.onupgradeneeded = (event) => {
      const db = (event.target as IDBOpenDBRequest).result;

      // å±¥æ­´ãƒã‚¹ã‚¿ã‚¹ãƒˆã‚¢ä½œæˆ
      if (!db.objectStoreNames.contains(MASTER_STORE_NAME)) {
        const masterStore = db.createObjectStore(MASTER_STORE_NAME, { keyPath: 'friendId' });
        masterStore.createIndex('friendId', 'friendId', { unique: true });
        masterStore.createIndex('lastImplementationDate', 'lastImplementationDate', { unique: false });
      }

      // é›†è¨ˆå±¥æ­´ã‚¹ãƒˆã‚¢ä½œæˆ
      if (!db.objectStoreNames.contains(HISTORY_STORE_NAME)) {
        const historyStore = db.createObjectStore(HISTORY_STORE_NAME, { keyPath: 'id' });
        historyStore.createIndex('month', 'month', { unique: false });
        historyStore.createIndex('createdAt', 'createdAt', { unique: false });
      }
    };
  });
}
```

---

## ãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

- **Vitest**: é«˜é€Ÿãªãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆViteçµ±åˆï¼‰
- **React Testing Library**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
- **jsdom**: DOMç’°å¢ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

### ãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰

```bash
# ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰ï¼ˆé–‹ç™ºä¸­ï¼‰
npm test

# UIãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
npm run test:ui

# CIç”¨ä¸€å›å®Ÿè¡Œ
npm run test:run

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ
npm run test:coverage
```

### ãƒ†ã‚¹ãƒˆæ§‹æˆ

```
src/
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ csvParser.ts
â”‚   â”œâ”€â”€ csvParser.test.ts         # 5ä»¶ã®ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ dataAggregator.ts
â”‚   â”œâ”€â”€ dataAggregator.test.ts    # 14ä»¶ã®ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ reviewDetector.ts
â”‚   â””â”€â”€ reviewDetector.test.ts    # 10ä»¶ã®ãƒ†ã‚¹ãƒˆ
â””â”€â”€ test/
    â””â”€â”€ setup.ts                   # ãƒ†ã‚¹ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
```

### ãƒ†ã‚¹ãƒˆä¾‹

#### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆcsvParser.test.tsï¼‰

```typescript
import { describe, it, expect } from 'vitest';
import { validateCSVFile } from './csvParser';

describe('validateCSVFile', () => {
  it('should accept valid CSV file', () => {
    const file = new File(['test'], 'test.csv', { type: 'text/csv' });
    const result = validateCSVFile(file);
    expect(result.valid).toBe(true);
    expect(result.error).toBeNull();
  });

  it('should reject non-CSV file', () => {
    const file = new File(['test'], 'test.txt', { type: 'text/plain' });
    const result = validateCSVFile(file);
    expect(result.valid).toBe(false);
    expect(result.error).toContain('CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
  });
});
```

#### ãƒ­ã‚¸ãƒƒã‚¯ãƒ†ã‚¹ãƒˆï¼ˆdataAggregator.test.tsï¼‰

```typescript
describe('isImplemented', () => {
  it('should return true for implemented record', () => {
    const record: CsvRecord = {
      äºˆç´„ID: '001',
      å‹ã ã¡ID: 'friend001',
      äºˆç´„æ—¥: '2025-12-01',
      ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 'äºˆç´„æ¸ˆã¿',
      'æ¥åº—/æ¥å ´': 'æ¸ˆã¿',
      åå‰: 'ãƒ†ã‚¹ãƒˆå¤ªéƒ',
      ç”³è¾¼æ—¥æ™‚: '2025-11-30 10:00',
    };
    expect(isImplemented(record)).toBe(true);
  });

  it('should return false for non-implemented record', () => {
    const record: CsvRecord = {
      ...
      ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿',
      'æ¥åº—/æ¥å ´': 'æ¸ˆã¿',
    };
    expect(isImplemented(record)).toBe(false);
  });
});
```

### ãƒ¢ãƒƒã‚¯ï¼ˆsrc/test/setup.tsï¼‰

```typescript
import '@testing-library/jest-dom';
import { cleanup } from '@testing-library/react';
import { afterEach, vi } from 'vitest';

afterEach(() => cleanup());

// IndexedDB ãƒ¢ãƒƒã‚¯
const indexedDBMock = {
  open: vi.fn(),
  deleteDatabase: vi.fn(),
};
global.indexedDB = indexedDBMock as unknown as IDBFactory;

// Blob URL ãƒ¢ãƒƒã‚¯
global.URL.createObjectURL = vi.fn(() => 'mock-url');
global.URL.revokeObjectURL = vi.fn();
```

---

## æ–°æ©Ÿèƒ½ã®è¿½åŠ æ–¹æ³•

### ä¾‹: æ–°ã—ã„é›†è¨ˆæŒ‡æ¨™ã‚’è¿½åŠ 

#### ã‚¹ãƒ†ãƒƒãƒ—1: å‹å®šç¾©ã‚’è¿½åŠ ï¼ˆsrc/types/index.tsï¼‰

```typescript
export interface AggregationSummary {
  first: {
    total: number;
    implemented: number;
    cancelled: number;
    implementationRate: number;
    // æ–°ã—ã„æŒ‡æ¨™ã‚’è¿½åŠ 
    averageDaysToVisit: number; // ç”³è¾¼ã‹ã‚‰æ¥åº—ã¾ã§ã®å¹³å‡æ—¥æ•°
  };
  repeat: {
    // åŒæ§˜ã«è¿½åŠ 
  };
}
```

#### ã‚¹ãƒ†ãƒƒãƒ—2: é›†è¨ˆãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ï¼ˆsrc/utils/dataAggregator.tsï¼‰

```typescript
export function aggregateSummary(csvData: CsvRecord[], masterData: Map<string, UserHistoryMaster>): AggregationSummary {
  // æ—¢å­˜ã®ãƒ­ã‚¸ãƒƒã‚¯...

  // æ–°ã—ã„æŒ‡æ¨™ã®è¨ˆç®—
  const averageDaysToVisit = calculateAverageDaysToVisit(csvData);

  return {
    first: {
      // æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰...
      averageDaysToVisit,
    },
    // ...
  };
}

function calculateAverageDaysToVisit(csvData: CsvRecord[]): number {
  // è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…
  const implementedRecords = csvData.filter(isImplemented);

  const totalDays = implementedRecords.reduce((sum, record) => {
    const applyDate = new Date(record.ç”³è¾¼æ—¥æ™‚);
    const visitDate = new Date(record.äºˆç´„æ—¥);
    const days = (visitDate.getTime() - applyDate.getTime()) / (1000 * 60 * 60 * 24);
    return sum + days;
  }, 0);

  return implementedRecords.length > 0 ? totalDays / implementedRecords.length : 0;
}
```

#### ã‚¹ãƒ†ãƒƒãƒ—3: UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ›´æ–°ï¼ˆsrc/components/SummaryCard.tsxï¼‰

```typescript
export function SummaryCard({ summary }: SummaryCardProps) {
  return (
    <Card>
      {/* æ—¢å­˜ã®è¡¨ç¤º... */}

      {/* æ–°ã—ã„æŒ‡æ¨™ã‚’è¿½åŠ  */}
      <Typography variant="body2">
        å¹³å‡æ¥åº—æ—¥æ•°: {summary.first.averageDaysToVisit.toFixed(1)}æ—¥
      </Typography>
    </Card>
  );
}
```

#### ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ï¼ˆsrc/utils/dataAggregator.test.tsï¼‰

```typescript
describe('averageDaysToVisit', () => {
  it('should calculate average days correctly', () => {
    const csvData: CsvRecord[] = [
      {
        äºˆç´„ID: '001',
        å‹ã ã¡ID: 'friend001',
        äºˆç´„æ—¥: '2025-12-10',
        ç”³è¾¼æ—¥æ™‚: '2025-12-01 10:00',
        ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 'äºˆç´„æ¸ˆã¿',
        'æ¥åº—/æ¥å ´': 'æ¸ˆã¿',
        åå‰: 'ãƒ†ã‚¹ãƒˆå¤ªéƒ',
      },
      // 9æ—¥å¾Œã«æ¥åº— â†’ å¹³å‡9æ—¥
    ];

    const masterData = new Map();
    const result = aggregateSummary(csvData, masterData);

    expect(result.first.averageDaysToVisit).toBeCloseTo(9, 1);
  });
});
```

#### ã‚¹ãƒ†ãƒƒãƒ—5: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°

- `docs/USER_MANUAL.md`: æ–°æ©Ÿèƒ½ã®ä½¿ã„æ–¹ã‚’èª¬æ˜
- `docs/DEVELOPER_GUIDE.md`: å®Ÿè£…ã®è©³ç´°ã‚’è¨˜éŒ²

---

## ãƒ‡ãƒãƒƒã‚°

### ãƒ–ãƒ©ã‚¦ã‚¶é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«

#### Chromeãƒ‡ãƒãƒƒã‚°

```
F12ã‚­ãƒ¼ â†’ Sources ã‚¿ãƒ– â†’ ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆè¨­å®š
```

#### React DevTools

```bash
# Chromeæ‹¡å¼µæ©Ÿèƒ½ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
# Componentsã‚¿ãƒ–ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ„ãƒªãƒ¼ã¨propsã‚’ç¢ºèª
```

#### Zustand DevTools

```typescript
// store/xxxStore.ts ã« devtools ã‚’è¿½åŠ 
import { devtools } from 'zustand/middleware';

export const useCsvStore = create<CsvStore>()(
  devtools(
    (set) => ({
      // ...
    }),
    { name: 'CsvStore' }
  )
);
```

### ãƒ­ã‚®ãƒ³ã‚°

```typescript
// é–‹ç™ºç’°å¢ƒã®ã¿ãƒ­ã‚°å‡ºåŠ›
if (import.meta.env.DEV) {
  console.log('Debug info:', data);
}

// ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ï¼ˆæœ¬ç•ªç’°å¢ƒã§ã‚‚å‡ºåŠ›ï¼‰
console.error('Error occurred:', error);
console.warn('Warning:', warning);
```

### IndexedDBã®ç¢ºèª

```
Chrome DevTools â†’ Application â†’ Storage â†’ IndexedDB
```

- `lstep-aggregation-db`
  - `user-history-master`: å±¥æ­´ãƒã‚¹ã‚¿
  - `aggregation-history`: é›†è¨ˆå±¥æ­´

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. React.memo ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é˜²æ­¢

```typescript
import { memo } from 'react';

export const SummaryCard = memo(({ summary }: SummaryCardProps) => {
  // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ­ã‚¸ãƒƒã‚¯
});
```

### 2. useMemo ã§é‡ã„è¨ˆç®—ã®ãƒ¡ãƒ¢åŒ–

```typescript
import { useMemo } from 'react';

function MyComponent({ data }: Props) {
  const aggregatedData = useMemo(() => {
    // é‡ã„é›†è¨ˆå‡¦ç†
    return aggregateSummary(data, masterData);
  }, [data, masterData]);

  return <div>{aggregatedData.total}</div>;
}
```

### 3. useCallback ã§ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®ãƒ¡ãƒ¢åŒ–

```typescript
import { useCallback } from 'react';

function MyComponent() {
  const handleUpload = useCallback(async (file: File) => {
    // å‡¦ç†
  }, []);

  return <CsvUploader onUpload={handleUpload} />;
}
```

### 4. ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã®æœ€é©åŒ–

```bash
# ãƒ“ãƒ«ãƒ‰ã‚µã‚¤ã‚ºã®åˆ†æ
npm run build -- --analyze

# ä¸è¦ãªä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å‰Šé™¤
npm prune
```

### 5. é…å»¶ãƒ­ãƒ¼ãƒ‰ï¼ˆCode Splittingï¼‰

```typescript
import { lazy, Suspense } from 'react';

const HeavyComponent = lazy(() => import('./HeavyComponent'));

function App() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <HeavyComponent />
    </Suspense>
  );
}
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼

#### TypeScriptã‚¨ãƒ©ãƒ¼

```bash
# å‹ãƒã‚§ãƒƒã‚¯
npx tsc --noEmit

# ã‚¨ãƒ©ãƒ¼è©³ç´°ã‚’ç¢ºèª
npx tsc --noEmit --pretty
```

#### ESLintã‚¨ãƒ©ãƒ¼

```bash
# ESLintãƒã‚§ãƒƒã‚¯
npm run lint

# è‡ªå‹•ä¿®æ­£
npm run lint -- --fix
```

### ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼

```bash
# ãƒ†ã‚¹ãƒˆã®è©³ç´°ãƒ­ã‚°
npm run test:run -- --reporter=verbose

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å®Ÿè¡Œ
npm run test:run -- csvParser.test.ts
```

### é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®å•é¡Œ

#### ãƒãƒ¼ãƒˆ3247ãŒä½¿ç”¨ä¸­

```bash
# ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèª
lsof -i :3247

# ãƒ—ãƒ­ã‚»ã‚¹ã‚’ã‚­ãƒ«
kill -9 <PID>
```

#### HMRãŒå‹•ä½œã—ãªã„

```bash
# node_modules ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤
rm -rf node_modules dist .vite
npm install
npm run dev
```

### IndexedDBã®å•é¡Œ

#### ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œãªã„

1. ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰ã‚’ç„¡åŠ¹åŒ–
2. ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ã‚’ç¢ºèª
3. IndexedDBã‚’ã‚¯ãƒªã‚¢: Chrome DevTools â†’ Application â†’ Clear storage

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å•é¡Œ

#### ãƒ“ãƒ«ãƒ‰ãŒé…ã„

```bash
# Viteã®è¨­å®šã‚’ç¢ºèªï¼ˆvite.config.tsï¼‰
# esbuildã®æœ€é©åŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’èª¿æ•´
```

#### å®Ÿè¡Œæ™‚ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒæ‚ªã„

1. React DevTools ã® Profiler ã§ç¢ºèª
2. ä¸è¦ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’ç‰¹å®š
3. `React.memo`ã€`useMemo`ã€`useCallback` ã‚’ä½¿ç”¨

---

## å‚è€ƒãƒªãƒ³ã‚¯

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [React 18](https://react.dev/)
- [TypeScript](https://www.typescriptlang.org/docs/)
- [Vite](https://vitejs.dev/)
- [MUI v7](https://mui.com/material-ui/getting-started/)
- [Zustand](https://zustand-demo.pmnd.rs/)
- [PapaParse](https://www.papaparse.com/docs)
- [TanStack Table](https://tanstack.com/table/v8)
- [Recharts](https://recharts.org/en-US/)
- [SheetJS](https://docs.sheetjs.com/)
- [Vitest](https://vitest.dev/)
- [Vercel](https://vercel.com/docs)

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [è¦ä»¶å®šç¾©æ›¸](./requirements.md)
- [ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰](./DEPLOYMENT.md)
- [ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ‹ãƒ¥ã‚¢ãƒ«](./USER_MANUAL.md)
- [é€²æ—ç®¡ç†](./SCOPE_PROGRESS.md)
- [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š](../CLAUDE.md)

---

**æœ€çµ‚æ›´æ–°æ—¥**: 2025-12-02
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.1
**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0
